%% A script to get down basics on logistic regression using mnrfit 

%% Load fisher iris dataset
clear
load fisheriris
sp = categorical(species); 

%% Pare down to just 2 species and 2 measurements for visualization

meas2 = meas(:,1:2);  

figure()
gscatter(meas2(:,1),meas2(:,2),sp,'rgb','osd')  
title("Fisher Iris Dataset")
xlabel('Sepal length');
ylabel('Sepal width'); 

%% Now perform logistic regression
close all
[B,dev,stats] = mnrfit(meas2,sp);  
pihat = mnrval(B,meas2); % should really understand better what mnrval does?
classes = pihat(:,1) > .5; 

% meshgrid
[x,y] = meshgrid(4:.1:8,2:.1:4.5); 
x = x(:);
y = y(:); 
pihat = mnrval(B,[x y]); 

figure(); 
subplot(1,2,1)
gscatter(meas2(:,1),meas2(:,2),classes)   
legend("Sesota","Virginica")  
subplot(1,2,2) 
gscatter(x,y,argmax(pihat'))  
legend("Sesota","Virginica")   
title("Meshgrid of logreg results")

%% Now try linear discriminant analysis 
lda = fitcdiscr(meas,sp); 
ldaClass = resubPredict(lda); 

figure()
bad = ~strcmp(ldaClass,species);
hold on;
plot(meas(bad,1), meas(bad,2), 'kx');
hold off;
[x,y] = meshgrid(4:.1:8,2:.1:4.5);
x = x(:);
y = y(:);
j = classify([x y],meas(:,1:2),species);
gscatter(x,y,j,'grb','sod')